<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çˆ†æ¬¾æ–‡æ¡ˆç”Ÿæˆ - AIæ™ºèƒ½åŠ©æ‰‹</title>
    <style>
        /* åŸºæœ¬é¡µé¢æ ·å¼ï¼Œä¸å¹²æ‰°CozeåŸç”Ÿæ ·å¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 
                         'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
    </style>
</head>
<body>
    <script type="text/javascript">
        var webSdkScript = document.createElement('script');
        webSdkScript.src = 'https://lf-cdn.coze.cn/obj/unpkg/flow-platform/chat-app-sdk/1.2.0-beta.19/libs/cn/index.js';
        document.head.appendChild(webSdkScript);

        webSdkScript.onload = function () {
            // æœåŠ¡è®¿é—®ä»¤ç‰Œï¼ˆSATï¼‰
            const serviceToken = 'sat_fz8c5xpgM0GIUWMSVnbIo5LNatLyL9InvnXjkBnJfmngNYwjOX8zmgCdEXEaLot6';
            
            // æ¸…é™¤æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„ä¼šè¯ç¼“å­˜ï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯æ–°ä¼šè¯
            try {
                // æ¸…é™¤localStorageä¸­æ‰€æœ‰Cozeç›¸å…³çš„æ•°æ®
                const localStorageKeys = Object.keys(localStorage);
                localStorageKeys.forEach(key => {
                    if (key && (
                        key.toLowerCase().indexOf('coze') >= 0 || 
                        key.toLowerCase().indexOf('session') >= 0 || 
                        key.toLowerCase().indexOf('chat') >= 0 ||
                        key.toLowerCase().indexOf('7576948828981608511') >= 0 || // App ID
                        key.toLowerCase().indexOf('7577062163073941540') >= 0     // Workflow ID
                    )) {
                        localStorage.removeItem(key);
                    }
                });
                
                // æ¸…é™¤sessionStorageä¸­æ‰€æœ‰Cozeç›¸å…³çš„æ•°æ®
                const sessionStorageKeys = Object.keys(sessionStorage);
                sessionStorageKeys.forEach(key => {
                    if (key && (
                        key.toLowerCase().indexOf('coze') >= 0 || 
                        key.toLowerCase().indexOf('session') >= 0 || 
                        key.toLowerCase().indexOf('chat') >= 0 ||
                        key.toLowerCase().indexOf('7576948828981608511') >= 0 ||
                        key.toLowerCase().indexOf('7577062163073941540') >= 0
                    )) {
                        sessionStorage.removeItem(key);
                    }
                });
                
                // æ¸…é™¤IndexedDBï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                if ('indexedDB' in window) {
                    indexedDB.databases().then(databases => {
                        databases.forEach(db => {
                            if (db.name && (
                                db.name.toLowerCase().indexOf('coze') >= 0 ||
                                db.name.toLowerCase().indexOf('session') >= 0 ||
                                db.name.toLowerCase().indexOf('chat') >= 0 ||
                                db.name.toLowerCase().indexOf('7576948828981608511') >= 0 ||
                                db.name.toLowerCase().indexOf('7577062163073941540') >= 0
                            )) {
                                indexedDB.deleteDatabase(db.name);
                            }
                        });
                    }).catch(() => {});
                }
            } catch (e) {
                console.log('æ¸…é™¤ç¼“å­˜æ—¶å‡ºé”™ï¼ˆå¯å¿½ç•¥ï¼‰:', e);
            }
            
            // ç”Ÿæˆæ–°çš„ä¼šè¯IDï¼Œæ¯æ¬¡åˆ·æ–°é¡µé¢æ—¶éƒ½ä¼šç”Ÿæˆæ–°çš„
            function generateSessionId() {
                const timestamp = Date.now();
                const random1 = Math.random().toString(36).substr(2, 9);
                const random2 = Math.random().toString(36).substr(2, 9);
                return 'session_' + timestamp + '_' + random1 + '_' + random2;
            }
            
            try {
                // ç”Ÿæˆæ–°çš„ä¼šè¯IDï¼ˆåœ¨åˆå§‹åŒ–ä¹‹å‰ï¼‰
                const newSessionId = generateSessionId();
                console.log('æ–°ä¼šè¯ID:', newSessionId);
                
                // ç”Ÿæˆå”¯ä¸€çš„ç”¨æˆ·IDï¼ˆæ¯æ¬¡è®¿é—®éƒ½ä¸åŒï¼Œç¡®ä¿æ–°ä¼šè¯ï¼‰
                const uniqueUserId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                
                // ä½¿ç”¨é»˜è®¤çš„æ‚¬æµ®æŒ‰é’®æ¨¡å¼ï¼Œä¸æŒ‡å®šcontainer
                const chatClient = new CozeWebSDK.WebChatClient({
                    "config": {
                        "type": "app",
                        "appInfo": {
                            "appId": "7576948828981608511",
                            "workflowId": "7577062163073941540"
                        },
                        // æ¯æ¬¡åˆ·æ–°é¡µé¢æ—¶ç”Ÿæˆæ–°çš„ä¼šè¯ID
                        "sessionId": newSessionId,
                        // ç¦ç”¨å†å²è®°å½•ï¼Œç¡®ä¿æ¯æ¬¡éƒ½æ˜¯æ–°ä¼šè¯
                        "enableHistory": false
                    },
                    "auth": {
                        "type": "token",
                        "token": serviceToken,
                        onRefreshToken: function () {
                            // è¿”å›ç›¸åŒçš„æœåŠ¡è®¿é—®ä»¤ç‰Œ
                            return serviceToken;
                        }
                    },
                    // ç”¨æˆ·ä¿¡æ¯ï¼šæ¯æ¬¡ç”Ÿæˆæ–°çš„ç”¨æˆ·IDï¼Œç¡®ä¿ä¸åŒä¼šè¯
                    "userInfo": {
                        "id": uniqueUserId,
                        "nickname": "è®¿å®¢"
                    }
                    // ä¸æŒ‡å®šcontainerï¼Œä½¿ç”¨é»˜è®¤çš„æ‚¬æµ®æŒ‰é’®æ¨¡å¼
                });
                
                // å…¨å±€ä¿å­˜ chatClient å¼•ç”¨ï¼Œæ–¹ä¾¿è°ƒè¯•
                window.cozeChatClient = chatClient;
                
                // è‡ªåŠ¨æ‰“å¼€å¯¹è¯æ¡†çš„å‡½æ•°
                function autoOpenDialog() {
                    try {
                        // æ–¹æ³•1: ä¼˜å…ˆå°è¯•è°ƒç”¨ open æ–¹æ³•ï¼ˆæœ€å¯é ï¼‰
                        if (chatClient) {
                            // æ‰“å° chatClient çš„æ‰€æœ‰æ–¹æ³•ï¼Œç”¨äºè°ƒè¯•
                            try {
                                var methods = Object.getOwnPropertyNames(Object.getPrototypeOf(chatClient));
                                console.log('ğŸ” chatClient å¯ç”¨æ–¹æ³•:', methods);
                            } catch (e) {}
                            
                            // æ£€æŸ¥æ˜¯å¦æœ‰ open æ–¹æ³•
                            if (typeof chatClient.open === 'function') {
                                chatClient.open();
                                console.log('âœ… å·²è°ƒç”¨ chatClient.open() æ–¹æ³•');
                                return true;
                            }
                            // æ£€æŸ¥æ˜¯å¦æœ‰ show æ–¹æ³•
                            if (typeof chatClient.show === 'function') {
                                chatClient.show();
                                console.log('âœ… å·²è°ƒç”¨ chatClient.show() æ–¹æ³•');
                                return true;
                            }
                            // æ£€æŸ¥æ˜¯å¦æœ‰ toggle æ–¹æ³•
                            if (typeof chatClient.toggle === 'function') {
                                chatClient.toggle();
                                console.log('âœ… å·²è°ƒç”¨ chatClient.toggle() æ–¹æ³•');
                                return true;
                            }
                        }
                        
                        // æ–¹æ³•2: æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„æŒ‰é’®å’Œå¯ç‚¹å‡»å…ƒç´ ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰
                        var allClickableElements = document.querySelectorAll('button, [role="button"], [onclick], [class*="button"], [class*="btn"], [class*="assistant"], [class*="chat"], [class*="coze"]');
                        console.log('ğŸ” æ‰¾åˆ°å¯ç‚¹å‡»å…ƒç´ æ•°é‡:', allClickableElements.length);
                        
                        var candidateButtons = [];
                        
                        for (var i = 0; i < allClickableElements.length; i++) {
                            var elem = allClickableElements[i];
                            var style = window.getComputedStyle(elem);
                            var rect = elem.getBoundingClientRect();
                            
                            // æ£€æŸ¥æ˜¯å¦å¯è§ä¸”åœ¨å³ä¸‹è§’åŒºåŸŸ
                            if (style.display !== 'none' && 
                                style.visibility !== 'hidden' &&
                                style.opacity !== '0' &&
                                rect.width > 0 && rect.height > 0) {
                                
                                // æ£€æŸ¥æ˜¯å¦åœ¨å³ä¸‹è§’ï¼ˆæ”¾å®½æ¡ä»¶ï¼‰
                                var isInBottomRight = (rect.right > window.innerWidth - 300 && 
                                                      rect.bottom > window.innerHeight - 300);
                                
                                // æ£€æŸ¥æ˜¯å¦æ˜¯å›ºå®šå®šä½
                                var isFixed = style.position === 'fixed';
                                
                                if (isFixed || isInBottomRight) {
                                    var distanceFromRight = window.innerWidth - rect.right;
                                    var distanceFromBottom = window.innerHeight - rect.bottom;
                                    var totalDistance = distanceFromRight + distanceFromBottom;
                                    
                                    // æ”¾å®½å°ºå¯¸é™åˆ¶
                                    if (rect.width > 20 && rect.width < 200 && 
                                        rect.height > 20 && rect.height < 200) {
                                        candidateButtons.push({
                                            element: elem,
                                            distance: totalDistance,
                                            rect: rect,
                                            className: elem.className,
                                            tagName: elem.tagName
                                        });
                                    }
                                }
                            }
                        }
                        
                        // æŒ‰è·ç¦»æ’åºï¼Œç‚¹å‡»æœ€æ¥è¿‘å³ä¸‹è§’çš„
                        candidateButtons.sort(function(a, b) {
                            return a.distance - b.distance;
                        });
                        
                        console.log('ğŸ” å€™é€‰æŒ‰é’®æ•°é‡:', candidateButtons.length);
                        if (candidateButtons.length > 0) {
                            console.log('ğŸ” å‰3ä¸ªå€™é€‰æŒ‰é’®:', candidateButtons.slice(0, 3).map(function(b) {
                                return {
                                    tag: b.tagName,
                                    class: b.className,
                                    distance: b.distance,
                                    rect: b.rect
                                };
                            }));
                        }
                        
                        if (candidateButtons.length > 0) {
                            var targetBtn = candidateButtons[0].element;
                            console.log('ğŸ” æ‰¾åˆ°æ‚¬æµ®æŒ‰é’®ï¼Œä½ç½®:', candidateButtons[0].rect, 'ç±»å:', candidateButtons[0].className);
                            targetBtn.click();
                            console.log('âœ… å·²ç‚¹å‡»æ‚¬æµ®æŒ‰é’®');
                            return true;
                        }
                        
                        // æ–¹æ³•3: æŸ¥æ‰¾æ‰€æœ‰å›ºå®šå®šä½çš„å…ƒç´ 
                        var allFixedElements = document.querySelectorAll('*');
                        var fixedCandidates = [];
                        
                        for (var j = 0; j < allFixedElements.length; j++) {
                            var fixedElem = allFixedElements[j];
                            var fixedStyle = window.getComputedStyle(fixedElem);
                            var fixedRect = fixedElem.getBoundingClientRect();
                            
                            if (fixedStyle.position === 'fixed' && 
                                fixedRect.width > 0 && fixedRect.height > 0 &&
                                fixedRect.right > window.innerWidth - 300 && 
                                fixedRect.bottom > window.innerHeight - 300) {
                                fixedCandidates.push({
                                    element: fixedElem,
                                    rect: fixedRect,
                                    className: fixedElem.className
                                });
                            }
                        }
                        
                        if (fixedCandidates.length > 0) {
                            console.log('ğŸ” æ‰¾åˆ°å›ºå®šå®šä½å…ƒç´ :', fixedCandidates.length, 'ä¸ª');
                            // ç‚¹å‡»ç¬¬ä¸€ä¸ª
                            fixedCandidates[0].element.click();
                            console.log('âœ… å·²ç‚¹å‡»å›ºå®šå®šä½å…ƒç´ ');
                            return true;
                        }
                        
                        console.log('âš ï¸ æœªæ‰¾åˆ°æ‚¬æµ®æŒ‰é’®');
                        console.log('ğŸ” è°ƒè¯•ä¿¡æ¯:', {
                            chatClientMethods: chatClient ? Object.getOwnPropertyNames(Object.getPrototypeOf(chatClient)) : 'chatClient is null',
                            allClickableCount: allClickableElements.length,
                            candidateCount: candidateButtons.length,
                            fixedCount: fixedCandidates.length
                        });
                    } catch (e) {
                        console.error('âŒ è‡ªåŠ¨æ‰“å¼€å¯¹è¯æ¡†æ—¶å‡ºé”™:', e);
                    }
                    return false;
                }
                
                // ç›‘å¬ ready äº‹ä»¶
                if (chatClient && typeof chatClient.on === 'function') {
                    chatClient.on('ready', function() {
                        console.log('ğŸ‰ SDK ready äº‹ä»¶è§¦å‘');
                        // å»¶è¿Ÿåå°è¯•æ‰“å¼€ï¼Œç»™SDKæ›´å¤šæ—¶é—´åˆå§‹åŒ–
                        setTimeout(function() {
                            console.log('ğŸ”„ ready äº‹ä»¶åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                            autoOpenDialog();
                        }, 800);
                    });
                }
                
                // å¤šæ¬¡å°è¯•æ‰“å¼€ï¼ˆé˜²æ­¢ ready äº‹ä»¶æœªè§¦å‘æˆ–å»¶è¿Ÿï¼Œå¢åŠ æ›´å¤šå°è¯•ï¼‰
                console.log('ğŸ”„ è®¾ç½®å®šæ—¶å™¨ï¼Œå°†åœ¨ä¸åŒæ—¶é—´ç‚¹å°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                setTimeout(function() {
                    console.log('ğŸ”„ 1ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 1000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 2ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 2000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 3ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 3000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 4ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 4000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 5ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 5000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 6ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 6000);
                
                setTimeout(function() {
                    console.log('ğŸ”„ 8ç§’åå°è¯•æ‰“å¼€å¯¹è¯æ¡†');
                    autoOpenDialog();
                }, 8000);
                
                // è‡ªå®šä¹‰UIï¼šä¿®æ”¹å ä½ç¬¦æ–‡æœ¬å’Œéšè—æ¨ªå¹…
                function customizeUI() {
                    try {
                        // 1. ä¿®æ”¹è¾“å…¥æ¡†å ä½ç¬¦æ–‡æœ¬ï¼šå°†"chatinputplaceholder"æ”¹ä¸º"è¯·è¾“å…¥ä¸»é¢˜æˆ–é“¾æ¥"
                        
                        // æ–¹æ³•1: ä¿®æ”¹ placeholder å±æ€§ï¼ˆåªæŸ¥æ‰¾Cozeç›¸å…³çš„å…ƒç´ ï¼Œæé«˜æ€§èƒ½ï¼‰
                        var inputs = document.querySelectorAll('[class*="coze"] input[type="text"], [class*="coze"] textarea, [class*="coze"] [contenteditable="true"], [class*="coze"] [contenteditable], [id*="coze"] input[type="text"], [id*="coze"] textarea, [id*="coze"] [contenteditable="true"], [id*="coze"] [contenteditable]');
                        inputs.forEach(function(input) {
                            if (input.placeholder && input.placeholder.toLowerCase().indexOf('chatinputplaceholder') >= 0) {
                                input.placeholder = 'è¯·è¾“å…¥ä¸»é¢˜æˆ–é“¾æ¥';
                            }
                            // æ£€æŸ¥ data-placeholder å±æ€§
                            if (input.getAttribute('data-placeholder') && 
                                input.getAttribute('data-placeholder').toLowerCase().indexOf('chatinputplaceholder') >= 0) {
                                input.setAttribute('data-placeholder', 'è¯·è¾“å…¥ä¸»é¢˜æˆ–é“¾æ¥');
                            }
                        });
                        
                        // æ–¹æ³•2: æŸ¥æ‰¾åŒ…å«å ä½ç¬¦æ–‡æœ¬çš„ div å…ƒç´ ï¼ˆåªæŸ¥æ‰¾Cozeç›¸å…³çš„å…ƒç´ ï¼‰
                        var cozeElements = document.querySelectorAll('[class*="coze"] *, [id*="coze"] *');
                        cozeElements.forEach(function(el) {
                            // è·³è¿‡è¾“å…¥æ¡†æœ¬èº«
                            if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.hasAttribute('contenteditable')) {
                                return;
                            }
                            
                            var text = (el.textContent || el.innerText || '').trim();
                            // å¦‚æœæ˜¯å ä½ç¬¦æ–‡æœ¬ï¼Œæ›¿æ¢å®ƒ
                            if (text.toLowerCase() === 'chatinputplaceholder' || 
                                text.toLowerCase().indexOf('chatinputplaceholder') >= 0) {
                                // æ£€æŸ¥æ˜¯å¦æ˜¯å ä½ç¬¦å…ƒç´ ï¼ˆé€šå¸¸æ˜¯ç©ºçš„æˆ–åªæœ‰å ä½ç¬¦æ–‡æœ¬ï¼Œä¸”æ˜¯å¶å­èŠ‚ç‚¹ï¼‰
                                if (el.children.length === 0 || 
                                    (el.children.length === 1 && el.children[0].textContent.trim() === '')) {
                                    el.textContent = 'è¯·è¾“å…¥ä¸»é¢˜æˆ–é“¾æ¥';
                                }
                            }
                            
                            // 2. éšè— "web_sdk_official_banner" æ–‡æœ¬
                            if (text.toLowerCase() === 'web_sdk_official_banner' || 
                                text.toLowerCase().indexOf('web_sdk_official_banner') >= 0) {
                                el.style.display = 'none';
                                el.style.visibility = 'hidden';
                                el.style.opacity = '0';
                                el.style.height = '0';
                                el.style.width = '0';
                                el.style.overflow = 'hidden';
                                el.style.margin = '0';
                                el.style.padding = '0';
                            }
                        });
                    } catch (e) {
                        // é™é»˜å¤„ç†é”™è¯¯ï¼Œä¸å½±å“å¯¹è¯æ¡†æ‰“å¼€
                    }
                }
                
                // ä½¿ç”¨ DOM è§‚å¯Ÿå™¨æ£€æµ‹æ‚¬æµ®æŒ‰é’®å‡ºç°åè‡ªåŠ¨ç‚¹å‡»ï¼Œå¹¶ä¿®æ”¹UI
                var opened = false;
                var observer = new MutationObserver(function(mutations) {
                    // ä¼˜å…ˆå°è¯•æ‰“å¼€å¯¹è¯æ¡†
                    if (!opened) {
                        opened = autoOpenDialog();
                    }
                    // ç„¶åä¿®æ”¹UIï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼Œé¿å…å½±å“å¯¹è¯æ¡†æ‰“å¼€ï¼‰
                    setTimeout(customizeUI, 100);
                });
                
                observer.observe(document.body, {
                    childList: true,
                    subtree: true,
                    attributes: true,
                    attributeFilter: ['class', 'style', 'placeholder']
                });
                
                // å®šæœŸæ‰§è¡ŒUIè‡ªå®šä¹‰ï¼ˆç¡®ä¿èƒ½æ•è·åˆ°åŠ¨æ€ç”Ÿæˆçš„å…ƒç´ ï¼‰
                var customizeInterval = setInterval(function() {
                    customizeUI();
                }, 1000);
                
                // 15ç§’ååœæ­¢è§‚å¯Ÿå’Œå®šæ—¶å™¨
                setTimeout(function() {
                    observer.disconnect();
                    clearInterval(customizeInterval);
                }, 15000);
                
            } catch (error) {
                console.error('Coze SDK åˆå§‹åŒ–é”™è¯¯:', error);
                document.body.innerHTML = '<div style="padding: 40px; text-align: center; color: #e74c3c;">åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®</div>';
            }
        };

        // é”™è¯¯å¤„ç†
        webSdkScript.onerror = function () {
            console.error('Failed to load Coze Web SDK');
            document.body.innerHTML = '<div style="padding: 40px; text-align: center; color: #e74c3c;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
        };
    </script>
</body>
</html>
